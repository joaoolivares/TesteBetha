RewriteEngine On
RewriteCond %{REQUEST_URI} !^/public/
RewriteCond %{REQUEST_URI} !^/upload/
RewriteCond $1 !^(index\.php|images|robots.txt)
RewriteRule ^(.*)$ index.php/$1 [L]